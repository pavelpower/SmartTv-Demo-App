<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Smartbox demo</title>
    <link rel="stylesheet" href="css/input.css"/>
    <link rel="stylesheet" href="css/keyboard.css"/>
    <link rel="stylesheet" href="css/legend.css"/>
    <link rel="stylesheet" href="css/style.css"/>
</head>
<body>

<!--for better view in browser-->
<div class="bg"></div>

<div class="wrap">

    <div class="menu">

        <div class="logo"></div>

        <ul class="menu-items" data-nav_type="vbox" data-nav_loop="true">
            <li data-content='input' class="menu-item menu-item_blue nav-item">Inputs</li>
            <li data-content='navigation' class="menu-item menu-item_red nav-item">Navigation</li>
        </ul>
    </div>

    <div class="scenes-wrapper">
        <div class="scene scene_input js-scene-input">
            <div class="input-example">
                <h2>Standart input</h2>
                <input id="input-1-value" class="input-item js-input-1 nav-item"/>
                <div class="input-val">
                    Input value: <span id="input-1" class="js-input-1-val"></span>
                </div>
            </div>
            <div class="input-example">
                <h2>Input with email keyboard</h2>
                <input id="input-2-value" class="input-item js-input-2 nav-item"/>
            </div>
            <div class="input-example">
                <h2>Input with num keyboard and maximum 4 signs</h2>
                <input id="input-3-value" class="input-item js-input-3 nav-item"/>
            </div>
        </div>
        <div class="scene js-scene-navigation">
            <ul class="navigation-items">
                <li class="navigation-item nav-item">1</li>
                <li class="navigation-item nav-item">2</li>
                <li class="navigation-item nav-item">3</li>
                <li class="navigation-item nav-item">4</li>
                <li class="navigation-item nav-item">5</li>
                <li class="navigation-item nav-item">6</li>
                <li class="navigation-item nav-item">7</li>
                <li class="navigation-item nav-item">8</li>
            </ul>
            <p class="navigation-info"></p>
        </div>
    </div>
</div>

<script type="text/javascript" src="js/vendor/jquery-1.10.2.min.js"></script>
<script type="text/javascript" src="js/vendor/lodash.compat.min.js"></script>
<script type="text/javascript" src="js/vendor/event_emitter.js"></script>
<script type="text/javascript" src="js/vendor/smartbox.js"></script>
<script type="text/javascript" src="js/app.js"></script>
<script type="text/javascript" src="js/scenes/navigation.js"></script>
<script type="text/javascript" src="js/scenes/input.js"></script>
<script type="text/javascript" src="js/legendTriggers.js"></script>

<script>

    (function(win, document) {

        /**
         * Page controller
         */
        var page = {
            // call after page load
            init: function (data, orignEvent) {
                this._source = orignEvent.source;
                this._source_origin = orignEvent.origin;

                this.getInputsValues();
            },

            key: function (data) {
                var smartBoxEvent;

                smartBoxEvent = translateKeyToSmartBoxCode(data);

                if (smartBoxEvent.name === 'REC') {
                    this.setInputsValues();
                }

                $$nav.triggerKeyEvent(smartBoxEvent.name.toLowerCase(), smartBoxEvent.data);
            },

            setInputsValues: function () {
                this._source.postMessage(JSON.stringify({
                    type: 'api',
                    name: 'setValue',
                    key: 'inputs',
                    value: $('input').map(function(i, elem) {
                        return {
                            id: $(elem).attr('id'),
                            value: $(elem).val()
                        }
                    }).get()
                }), this._source_origin);
            },

            getInputsValues: function () {
                this._source.postMessage(JSON.stringify({
                    type: 'api',
                    name: 'getValue',
                    key: 'inputs'
                }), this._source_origin);
            },

            response: function (data) {
                var values, i = 0, len;

                if (data.name === 'getValue' && data.key === 'inputs') {

                    values = JSON.parse(data.value);

                    len = values.length;

                    $$log('get values from storage:' +  values[i].value, 'log');

                    for (; i < len; i++) {
                        $$log(values[i].id, 'log');
                        $('#' +  values[i].id).val( values[i].value);
                    }
                }
            }
        };

        function translateKeyToSmartBoxCode(data) {
            var smartboxKeyName,
                transHeshKey = {
                    CHMINUS: 'CH_DOWN',
                    CHPLUS: 'CH_UP',
                    FWD:'FF',
                    REW:'RW',
                    RECORD:'REC',
                    SEARCH:'TOOLS',
                    SUBTITLE_TELETEXT: 'SUBT'
                };

            smartboxKeyName = data.name.replace('key', '');

            if (smartboxKeyName === 'DIGIT') {
                return {
                    name: 'NUM',
                    data: {
                        num: data.digit
                    }
                }
            }

            if (transHeshKey[smartboxKeyName]) {
                return {
                    name: transHeshKey[smartboxKeyName]
                }
            }

            return {
                name: smartboxKeyName
            };
        }

        win.addEventListener('message', function(event) {
            try {
                var message = JSON.parse(event.data);
                if (typeof page[message.type] === 'function') {
                    page[message.type](message, event);
                }
            } catch (e) {
                $$log(e.message, 'log');
            }
        });

    })(window, window.document);


</script>
</body>
</html>